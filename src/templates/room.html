{% extends "base.html" %}

{% block title %}ChatRoom{% endblock %}

{% block head %}
{% endblock %}

{% block body %}
<div>
    <h1>Welcome to ChatRoom, {{username}}!</h1>
</div>
<ul id="message_list"></ul>
<input id="message" type="text" name="message" placeholder="Enter your message...">
<input id="send_message" type="button" value="Send">
<input id="leave" type="button" value="Leave">

<script type="text/javascript">
    socket = io();
    msg_input = document.getElementById('message');
    document.getElementById('send_message').onclick = send_message;
    document.getElementById('leave').onclick = leave_room;
    msg_input.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            send_message()
        }
    });
    function send_message() {
        socket.emit('message_sent', msg_input.value)
        msg_input.value = ''
    };

    function show_message(message){
        var li = document.createElement('li');
        li.innerHTML = message
        msg_list = document.getElementById('message_list');
        msg_list.appendChild(li)
    }

    function leave_room() {
        socket.emit('leave_room')
        window.location.href = '/logout'
    };

    socket.on('recieve_message', (sender, message) => show_message(`${sender}: ${message}`))
    socket.on('user_joined', (username) => show_message(`${username} has joined the room.`))
    socket.on('user_left', (username) => show_message(`${username} has left the room.`))
</script>
{% endblock %}